# Implementation Tasks: Advanced Features

## 1. 系统函数 (System Functions)

### 1.1 POS(x) - 光标位置
- [ ] 1.1.1 在 tokenizer 中添加 POS 关键字
- [ ] 1.1.2 在 parser 中实现 POS 函数调用解析
- [ ] 1.1.3 在 executor 中跟踪当前打印列位置（在 PRINT 语句中更新）
- [ ] 1.1.4 在 executor 中实现 POS(x) 函数（返回当前列位置，1-based）
- [ ] 1.1.5 处理 TAB 和 SPC 对列位置的影响
- [ ] 1.1.6 处理换行符重置列位置
- [ ] 1.1.7 添加单元测试

## 2. 用户自定义函数 (User-Defined Functions)

### 2.1 DEF FN 语句解析
- [ ] 2.1.1 在 tokenizer 中添加 DEF 和 FN 关键字
- [ ] 2.1.2 在 parser 中实现 DEF FN 语句解析
- [ ] 2.1.3 解析函数名、参数名和表达式体
- [ ] 2.1.4 添加 AST 节点（Statement::DefFn）

### 2.2 单行函数定义
- [ ] 2.2.1 设计函数存储结构（在 Variables 或新建 Functions 模块）
- [ ] 2.2.2 实现函数定义存储（名称、参数、表达式）
- [ ] 2.2.3 支持单行函数定义
- [ ] 2.2.4 添加函数查找和验证逻辑

### 2.3 函数调用 FN name(arg)
- [ ] 2.3.1 在 parser 中实现 FN 调用解析（作为表达式的一部分）
- [ ] 2.3.2 在 executor 中实现函数调用逻辑
- [ ] 2.3.3 实现参数绑定（将参数值绑定到参数名）
- [ ] 2.3.4 在函数作用域中求值表达式
- [ ] 2.3.5 返回函数结果

### 2.4 函数作用域管理
- [ ] 2.4.1 实现函数参数作用域
- [ ] 2.4.2 处理局部变量作用域（如果需要）
- [ ] 2.4.3 处理变量作用域冲突（函数参数 vs 全局变量）
- [ ] 2.4.4 确保函数调用不影响全局变量

### 2.5 测试用户定义函数
- [ ] 2.5.1 编写单元测试
- [ ] 2.5.2 测试函数定义和调用
- [ ] 2.5.3 测试作用域和参数绑定
- [ ] 2.5.4 测试错误情况（未定义函数、参数不匹配等）

## 3. 高级语句 (Advanced Statements)

### 3.1 GET 语句
- [ ] 3.1.1 在 tokenizer 中添加 GET 关键字
- [ ] 3.1.2 在 parser 中实现 GET 语句解析（GET variable）
- [ ] 3.1.3 实现单字符输入逻辑（从 stdin 读取单个字符，不等待回车）
- [ ] 3.1.4 处理字符串变量（存储字符）和数值变量（存储 ASCII 码）
- [ ] 3.1.5 处理无输入情况（返回空字符串或 0）
- [ ] 3.1.6 添加单元测试

### 3.2 NULL 语句
- [ ] 3.2.1 在 tokenizer 中添加 NULL 关键字
- [ ] 3.2.2 在 parser 中实现 NULL 语句解析
- [ ] 3.2.3 实现空语句执行（无操作，直接返回 Ok）
- [ ] 3.2.4 添加单元测试（验证不改变程序状态）

## 4. 集成测试

- [ ] 4.1 编写综合测试程序（使用所有高级功能）
- [ ] 4.2 测试 POS 函数与 PRINT 语句的集成
- [ ] 4.3 测试用户自定义函数集成
- [ ] 4.4 测试 GET 和 NULL 语句集成
- [ ] 4.5 验证兼容性（确保不影响现有功能）

## 5. 文档

- [ ] 5.1 更新用户文档（添加高级功能说明）
- [ ] 5.2 添加使用示例
- [ ] 5.3 更新 API 文档
- [ ] 5.4 更新 tasks.md（标记已完成的任务）

