# Implementation Tasks

## 1. 项目初始化
- [ ] 1.1 创建 Cargo 项目结构
- [ ] 1.2 配置 Cargo.toml 依赖
- [ ] 1.3 设置基础错误类型和结果类型
- [ ] 1.4 创建项目 README
- [ ] 1.5 设置测试框架

## 2. 词法分析器 (Tokenizer)
- [ ] 2.1 定义 Token 枚举类型
- [ ] 2.2 定义所有保留字 (27个语句关键字)
- [ ] 2.3 定义所有函数名 (22个内置函数)
- [ ] 2.4 定义运算符 token
- [ ] 2.5 实现数字常量识别 (整数和浮点数)
- [ ] 2.6 实现标识符识别 (变量名、行号)
- [ ] 2.7 实现字符串常量识别
- [ ] 2.8 处理空格和注释
- [ ] 2.9 实现行号解析
- [ ] 2.10 编写词法分析器单元测试

## 3. 语法解析器 (Parser)
- [ ] 3.1 定义抽象语法树 (AST) 数据结构
- [ ] 3.2 实现表达式解析 (递归下降或优先级攀升)
- [ ] 3.3 实现语句解析器基础框架
- [ ] 3.4 解析简单语句 (LET, PRINT, REM, END)
- [ ] 3.5 解析流程控制语句 (GOTO, IF)
- [ ] 3.6 解析循环语句 (FOR...NEXT)
- [ ] 3.7 解析子程序调用 (GOSUB, RETURN)
- [ ] 3.8 解析数组和函数调用
- [ ] 3.9 实现错误恢复机制
- [ ] 3.10 编写解析器单元测试

## 4. 运行时环境 (Runtime)
- [ ] 4.1 定义程序状态结构
- [ ] 4.2 实现程序行存储和索引
- [ ] 4.3 实现程序计数器和行号跳转
- [ ] 4.4 实现 GOSUB 栈管理
- [ ] 4.5 实现 FOR 循环栈管理
- [ ] 4.6 实现直接模式 vs 程序模式
- [ ] 4.7 实现 NEW 命令 (清空程序)
- [ ] 4.8 实现 LIST 命令 (列出程序)
- [ ] 4.9 实现 RUN 命令
- [ ] 4.10 实现 STOP, END, CONT 命令
- [ ] 4.11 编写运行时单元测试

## 5. 变量系统 (Variables)
- [ ] 5.1 定义变量值类型 (整数、浮点、字符串)
- [ ] 5.2 实现变量名解析 (A-Z, A0-Z9, A-Z$)
- [ ] 5.3 实现简单变量存储 (HashMap)
- [ ] 5.4 实现数组变量存储
- [ ] 5.5 实现 DIM 语句
- [ ] 5.6 实现数组边界检查
- [ ] 5.7 实现多维数组支持
- [ ] 5.8 实现变量类型检查
- [ ] 5.9 实现 CLEAR 命令 (清空变量)
- [ ] 5.10 编写变量系统单元测试

## 6. 基础语句实现
- [ ] 6.1 LET 语句 (赋值)
- [ ] 6.2 PRINT 语句 (基础输出)
- [ ] 6.3 PRINT 使用分隔符 (逗号、分号)
- [ ] 6.4 PRINT TAB() 和 SPC() 函数
- [ ] 6.5 REM 语句 (注释)
- [ ] 6.6 GOTO 语句
- [ ] 6.7 IF...THEN 语句
- [ ] 6.8 GOSUB 和 RETURN 语句
- [ ] 6.9 ON...GOTO 和 ON...GOSUB 语句
- [ ] 6.10 FOR...NEXT 语句
- [ ] 6.11 FOR...STEP 支持
- [ ] 6.12 测试所有基础语句

## 7. 运算符实现
- [ ] 7.1 算术运算符 (+, -, *, /)
- [ ] 7.2 乘方运算符 (^)
- [ ] 7.3 一元负号 (-)
- [ ] 7.4 关系运算符 (=, <>, <, >, <=, >=)
- [ ] 7.5 逻辑运算符 (AND, OR, NOT)
- [ ] 7.6 字符串连接 (+)
- [ ] 7.7 运算符优先级处理
- [ ] 7.8 类型转换和检查
- [ ] 7.9 测试所有运算符

## 8. 浮点运算 (Float Arithmetic)
- [ ] 8.1 选择浮点数表示 (f64 或自定义)
- [ ] 8.2 实现加法和减法
- [ ] 8.3 实现乘法和除法
- [ ] 8.4 实现乘方运算
- [ ] 8.5 实现数值比较
- [ ] 8.6 实现整数和浮点转换
- [ ] 8.7 实现浮点数输入解析
- [ ] 8.8 实现浮点数输出格式化
- [ ] 8.9 处理溢出和下溢
- [ ] 8.10 测试浮点运算精度

## 9. 数学函数
- [ ] 9.1 SGN(x) - 符号函数
- [ ] 9.2 INT(x) - 取整函数
- [ ] 9.3 ABS(x) - 绝对值
- [ ] 9.4 SQR(x) - 平方根
- [ ] 9.5 EXP(x) - 指数函数
- [ ] 9.6 LOG(x) - 自然对数
- [ ] 9.7 SIN(x), COS(x), TAN(x) - 三角函数
- [ ] 9.8 ATN(x) - 反正切
- [ ] 9.9 RND(x) - 随机数
- [ ] 9.10 测试所有数学函数

## 10. 字符串功能
- [ ] 10.1 字符串变量存储
- [ ] 10.2 字符串连接操作
- [ ] 10.3 LEN(s$) - 字符串长度
- [ ] 10.4 LEFT$(s$, n) - 左子串
- [ ] 10.5 RIGHT$(s$, n) - 右子串
- [ ] 10.6 MID$(s$, n[, m]) - 中间子串
- [ ] 10.7 STR$(x) - 数字转字符串
- [ ] 10.8 VAL(s$) - 字符串转数字
- [ ] 10.9 ASC(s$) - 字符 ASCII 码
- [ ] 10.10 CHR$(x) - ASCII 码转字符
- [ ] 10.11 字符串比较
- [ ] 10.12 测试所有字符串函数

## 11. 输入输出 (I/O)
- [ ] 11.1 实现基础 INPUT 语句
- [ ] 11.2 INPUT 提示符支持
- [ ] 11.3 INPUT 多个变量
- [ ] 11.4 INPUT 错误处理和重试
- [ ] 11.5 实现 DATA 语句
- [ ] 11.6 实现 READ 语句
- [ ] 11.7 实现 RESTORE 语句
- [ ] 11.8 集成 rustyline 行编辑
- [ ] 11.9 实现命令历史
- [ ] 11.10 测试 I/O 功能

## 12. 系统函数
- [ ] 12.1 FRE(x) - 剩余内存
- [ ] 12.2 POS(x) - 光标位置
- [ ] 12.3 PEEK(addr) - 读内存 (模拟)
- [ ] 12.4 POKE addr, value - 写内存 (模拟)
- [ ] 12.5 WAIT 语句
- [ ] 12.6 测试系统函数

## 13. 用户自定义函数
- [ ] 13.1 DEF FN 语句解析
- [ ] 13.2 单行函数定义
- [ ] 13.3 函数调用 FN name(arg)
- [ ] 13.4 函数作用域管理
- [ ] 13.5 测试用户定义函数

## 14. 错误处理
- [ ] 14.1 定义所有错误类型
- [ ] 14.2 实现错误消息 (中文/英文)
- [ ] 14.3 语法错误报告 (行号、位置)
- [ ] 14.4 运行时错误处理
- [ ] 14.5 STOP 和 END 的区别
- [ ] 14.6 CONT 命令恢复执行
- [ ] 14.7 测试错误处理

## 15. 交互模式
- [ ] 15.1 REPL 主循环
- [ ] 15.2 直接模式命令执行
- [ ] 15.3 程序编辑 (输入行号)
- [ ] 15.4 行删除 (输入空行)
- [ ] 15.5 LIST 命令变体 (LIST 10-50)
- [ ] 15.6 启动横幅和提示符
- [ ] 15.7 退出命令
- [ ] 15.8 测试交互模式

## 16. 高级功能 (可选)
- [ ] 16.1 LOAD 命令 (从文件加载程序)
- [ ] 16.2 SAVE 命令 (保存程序到文件)
- [ ] 16.3 GET 语句 (单字符输入)
- [ ] 16.4 NULL 语句
- [ ] 16.5 CMD 和 SYS 语句
- [ ] 16.6 文件格式定义
- [ ] 16.7 测试文件操作

## 17. 集成测试
- [ ] 17.1 简单程序测试 (Hello World)
- [ ] 17.2 循环测试 (求和、阶乘)
- [ ] 17.3 数组测试 (排序、搜索)
- [ ] 17.4 字符串处理测试
- [ ] 17.5 子程序测试
- [ ] 17.6 递归函数测试
- [ ] 17.7 经典游戏测试 (猜数字、星际迷航)
- [ ] 17.8 数学计算测试
- [ ] 17.9 综合测试程序
- [ ] 17.10 性能基准测试

## 18. 文档和完善
- [ ] 18.1 完善代码注释
- [ ] 18.2 编写用户手册
- [ ] 18.3 编写开发者文档
- [ ] 18.4 添加使用示例
- [ ] 18.5 优化错误消息
- [ ] 18.6 代码重构和清理
- [ ] 18.7 性能分析和优化
- [ ] 18.8 最终测试

## 19. 部署和发布
- [ ] 19.1 配置 CI/CD
- [ ] 19.2 创建发布版本
- [ ] 19.3 编写 CHANGELOG
- [ ] 19.4 准备示例程序
- [ ] 19.5 发布第一个版本

